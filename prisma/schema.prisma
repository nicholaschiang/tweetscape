generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model annotations {
  tweet_id        String
  normalized_text String
  probability     Decimal         @db.Decimal
  type            annotation_type
  start           Int
  end             Int
  tweets          tweets          @relation(fields: [tweet_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([tweet_id, normalized_text])
}

model clusters {
  id         String   @id
  name       String   @unique
  slug       String   @unique
  active     Boolean  @default(false)
  created_at DateTime @db.Timestamptz(6)
  updated_at DateTime @db.Timestamptz(6)
  visible    Boolean  @default(false)
  scores     scores[]
}

model influencers {
  id                String           @id
  name              String
  username          String
  description       String?
  profile_image_url String?
  followers_count   Int?
  following_count   Int?
  tweets_count      Int?
  created_at        DateTime?        @db.Timestamptz(6)
  updated_at        DateTime?        @db.Timestamptz(6)
  list_followers    list_followers[]
  list_members      list_members[]
  lists             lists[]
  mentions          mentions[]
  scores            scores[]
  tokens            tokens?
  tweets            tweets[]
}

model links {
  url         String   @id
  display_url String
  status      Int?
  title       String?
  description String?
  unwound_url String?
  images      images[]
  urls        urls[]
}

model mentions {
  tweet_id      String
  influencer_id String
  start         Int
  end           Int
  influencers   influencers @relation(fields: [influencer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tweets        tweets      @relation(fields: [tweet_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([tweet_id, influencer_id])
}

model refs {
  referenced_tweet_id                     String
  referencer_tweet_id                     String
  type                                    ref_type
  tweets_refs_referenced_tweet_idTotweets tweets   @relation("refs_referenced_tweet_idTotweets", fields: [referenced_tweet_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tweets_refs_referencer_tweet_idTotweets tweets   @relation("refs_referencer_tweet_idTotweets", fields: [referencer_tweet_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([referenced_tweet_id, referencer_tweet_id])
}

model scores {
  id                          String      @id
  influencer_id               String
  cluster_id                  String
  attention_score             Decimal     @db.Decimal
  attention_score_change_week Decimal?    @db.Decimal
  insider_score               Decimal     @db.Decimal
  organization_rank           Int?
  personal_rank               Int?
  rank                        Int
  created_at                  DateTime    @db.Timestamptz(6)
  clusters                    clusters    @relation(fields: [cluster_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  influencers                 influencers @relation(fields: [influencer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([cluster_id, influencer_id])
  @@unique([cluster_id, rank])
}

model tags {
  tweet_id String
  tag      String
  type     tag_type
  start    Int
  end      Int
  tweets   tweets   @relation(fields: [tweet_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([tweet_id, tag, type])
}

model tweets {
  id                                    String        @id
  author_id                             String
  text                                  String
  retweet_count                         Int
  reply_count                           Int
  like_count                            Int
  quote_count                           Int
  created_at                            DateTime      @db.Timestamptz(6)
  influencers                           influencers   @relation(fields: [author_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  annotations                           annotations[]
  mentions                              mentions[]
  refs_refs_referenced_tweet_idTotweets refs[]        @relation("refs_referenced_tweet_idTotweets")
  refs_refs_referencer_tweet_idTotweets refs[]        @relation("refs_referencer_tweet_idTotweets")
  tags                                  tags[]
  urls                                  urls[]
}

model urls {
  tweet_id String
  link_url String
  start    Int
  end      Int
  links    links  @relation(fields: [link_url], references: [url], onDelete: NoAction, onUpdate: NoAction)
  tweets   tweets @relation(fields: [tweet_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([tweet_id, link_url])
}

model images {
  link_url String
  url      String
  width    Int
  height   Int
  links    links  @relation(fields: [link_url], references: [url], onDelete: NoAction, onUpdate: NoAction)

  @@id([link_url, url, width, height])
}

model tokens {
  influencer_id String      @id
  token_type    String
  expires_in    Int
  access_token  String      @unique
  scope         String
  refresh_token String      @unique
  created_at    DateTime    @db.Timestamptz(6)
  updated_at    DateTime    @db.Timestamptz(6)
  influencers   influencers @relation(fields: [influencer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model lists {
  id             String           @id
  owner_id       String
  name           String
  description    String
  private        Boolean
  follower_count Int
  member_count   Int
  created_at     DateTime         @db.Timestamptz(6)
  influencers    influencers      @relation(fields: [owner_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  list_followers list_followers[]
  list_members   list_members[]
}

model list_followers {
  influencer_id String
  list_id       String
  influencers   influencers @relation(fields: [influencer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lists         lists       @relation(fields: [list_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([influencer_id, list_id])
}

model list_members {
  influencer_id String
  list_id       String
  influencers   influencers @relation(fields: [influencer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  lists         lists       @relation(fields: [list_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([influencer_id, list_id])
}

enum annotation_type {
  Person
  Place
  Product
  Organization
  Other
}

enum ref_type {
  quoted
  retweeted
  replied_to
}

enum tag_type {
  cashtag
  hashtag
}
